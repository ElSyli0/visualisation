<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin=""/>
		<link rel="stylesheet" href="http://code.ionicframework.com/ionicons/1.5.2/css/ionicons.min.css">
		<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.0/css/font-awesome.css" rel="stylesheet">
		<title>Visu</title>   <!-- Set the title of the page here -->
		<style type="text/css">   /* The CSS code goes here */

			/* CSS code for the element that has the id map */

			#map {
				width: 1000px;   /* Dimensions of the map element */
				height: 600px;
			}

			/* CSS code for the elements that have the class dot */
			.beautiful_button {
				background-color: steelblue;   /* The buttons are colored in steelblue */
				border: none;   /* The buttons have no border */
				color: white;   /* The text inside the buttons is white */
				padding: 15px 32px;   /* Defines the space in pixels between the text inside the buttons and their edges */
				text-align: center;   /* The text inside the buttons is centered */
				font-size: 16px;   /* Font size of the text inside the buttons */
			}
			.Event_button {
				background-color: steelblue;   /* The buttons are colored in steelblue */
				border: none;   /* The buttons have no border */
				color: white;   /* The text inside the buttons is white */
				padding: 15px 32px;   /* Defines the space in pixels between the text inside the buttons and their edges */
				text-align: center;   /* The text inside the buttons is centered */
				font-size: 16px;   /* Font size of the text inside the buttons */
			}
			#buttons_container{
				width: 1000px;   /* Dimensions of the buttons_container element */
				text-align: center;   /* Centers the contents of the buttons_container element */
			}
			#checkboxesContainer{
				width : 1000px;
				text-align: center;
			}

		</style>
		<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.42.2/mapbox-gl.css' rel='stylesheet'></link>   <!-- Import of the styles from Mapbox -->
		<link rel="stylesheet" href="css/leaflet.awesome-markers.css"></link>
	</head>
	<body>
		<ion-icon name="earth"></ion-icon>

		<div id="map"></div>   <!-- Working example - Map with points -->
		<div id="buttons_container">
			<h2>Choix des délimitations</h2>
			<button id="Continents" class="beautiful_button">Continents</button>
			<button id="Countries" class="beautiful_button">Countries</button>
			<button id="Plates" class="beautiful_button">Plates</button>
			<button id="ClearDelim" class="beautiful_button">Clear_Delim</button>
		</div>
		<div id="checkboxesContainer">
			<h2>Choix des events</h2>
				<button id="Earthquake" class="Event_button" value="off">Earthquake</button>
				<button id="Tsunami" class="Event_button" value="off">Tsunami</button>
				<button id="Volcano" class="Event_button" value="off">Volcano</button>
				<button id="ClearEvents" class="Event_button" value="off">Clear</button>
		</div>
	</body>
</html>
<script src='https://d3js.org/d3.v3.min.js'></script>   <!-- d3.js library import (I personnaly use the version 3 but you can use another version. Some of the examples may not work correctly if the version is changed) -->
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
   crossorigin=""></script>
<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
<script src="js/leaflet.awesome-markers.js"></script>
<script type="text/javascript">
var mymap = L.map('map', { zoomControl: false }).setView([27, 0], 2);
/*
mymap.doubleClickZoom.disable();
mymap.scrollWheelZoom.disable();
mymap.boxZoom.disable();
mymap.keyboard.disable();
*/
L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'mapbox/light-v10',
    tileSize: 512,
    zoomOffset: -1,
    accessToken: 'sk.eyJ1IjoiY2hpZWZkdXBhbiIsImEiOiJja3Z3cDg5dGMxbmpkMnZtOW42aHQ4N3FqIn0.9bgkgEMeGUihgjpmoDDhVQ'
}).addTo(mymap);
function Polygon_clean(Data){
	let features=Array();
	for (let i=0;i<Data.features.length;i++){
		if (Data.features[i].geometry.type=="MultiPolygon" && Data.features[i].properties.name){
			for (let j=0;j<Data.features[i].geometry.coordinates.length;j++){
				let point={type:"Feature",
									geometry :{
										type: "Polygon",
										coordinates :Data.features[i].geometry.coordinates[j]
									},
									properties : {
											name : Data.features[i].properties.name
									}
				}
				features.push(point);
			}
		} else if(Data.features[i].geometry.type=="Polygon" && Data.features[i].properties.name){
			let point={type:"Feature",
								geometry :{
									type: "Polygon",
									coordinates :Data.features[i].geometry.coordinates
								},
								properties : {
									name : Data.features[i].properties.name
								}
			}
			features.push(point);
		} else if (Data.features[i].geometry.type=="Polygon" && Data.features[i].properties.continent){
			let point={type:"Feature",
								geometry :{
									type: "Polygon",
									coordinates :Data.features[i].geometry.coordinates
								},
								properties : {
									name : Data.features[i].properties.continent
								}
			}
			features.push(point);
		} else if (Data.features[i].geometry.type=="MultiPolygon" && Data.features[i].properties.continent){
			for (let j=0;j<Data.features[i].geometry.coordinates.length;j++){
				let point={type:"Feature",
									geometry :{
										type: "Polygon",
										coordinates :Data.features[i].geometry.coordinates[j]
									},
									properties : {
											name : Data.features[i].properties.name
									}
				}
				features.push(point);
			}
		} else {
			console.log(i);
			console.log(Data.features[i]);
		}
	}
	return features
}
function getGeoJSON_E(DataJson){
	let features =Array();
	for (let i=0;i<DataJson.length;i++){
		if (DataJson[i].longitude && DataJson[i].latitude && DataJson[i].intensity >3 && DataJson[i].latitude > -70 && DataJson[i].latitude < 80) {
			let point={type:"Feature",
							geometry : {
								type: "Point",
								coordinates : [DataJson[i].longitude, DataJson[i].latitude]
							},
							properties : {
								id : DataJson[i].id,
								intensity : DataJson[i].intensity,
							}
			}
			features.push(point);
		} /*else {
			console.log(i);
			console.log(DataJson[i]);
		} */
	}
	return features
}
function getGeoJSON_T(DataJson){
	let features =Array();
	for (let i=0;i<DataJson.length;i++){
		if (DataJson[i].longitude && DataJson[i].latitude && DataJson[i].eventValidity >1&& DataJson[i].latitude > -70 && DataJson[i].latitude < 80) {
			let point={type:"Feature",
							geometry : {
								type: "Point",
								coordinates : [DataJson[i].longitude, DataJson[i].latitude]
							},
							properties : {
								id : DataJson[i].id,
								intensity : DataJson[i].intensity,
							}
			}
			features.push(point);
		} /*else {
			console.log(i);
			console.log(DataJson[i]);
		} */
	}
	return features
}
function getGeoJSON_V(DataJson){
	let features =Array();
	for (let i=0;i<DataJson.length;i++){
		if (DataJson[i].longitude && DataJson[i].latitude && DataJson[i].latitude > -70 && DataJson[i].latitude < 80) {
			let point={type:"Feature",
							geometry : {
								type: "Point",
								coordinates : [DataJson[i].longitude, DataJson[i].latitude]
							},
							properties : {
								id : DataJson[i].id,
								intensity : DataJson[i].intensity,
							}
			}
			features.push(point);
		}
	}
	return features
}
	d3.json("continents_clean.json", function(continents){   // The code in the function is executed only when the data is loaded. All code requiring that the data is fully loaded shoud come here
	d3.json("countries_continent.geojson",function(countries){
	d3.json("Tect.json",function(tect){
	d3.json("earthquakes_events.json",function(Da_ear){
	d3.json("tsunamis_events.json",function(Da_tsu){
	d3.json("volcano_locations.json",function(Da_vol){
		/*
			console.log(continents);
			console.log(countries);
			console.log(tect);
			console.log(Da_ear);
			console.log(Da_tsu);
			console.log(Da_vol);
		*/
		// Creates a red marker with the coffee icon
var MarkerTsu = L.AwesomeMarkers.icon({
	icon: 'tint',
	markerColor: 'darkblue',
	prefix:'fa',
	iconColor:'white',
});
var MarkerEar = L.AwesomeMarkers.icon({
	icon:'globe',
	markerColor: 'beige',
	prefix:'fa',
	iconColor:'black',
});
var MarkerVol = L.AwesomeMarkers.icon({
	icon:'fire',
	markerColor: 'darkred',
	prefix:'fa',
	iconColor:'white',
})
			let Data_earthquake ={type :"FeatureCollection", features : getGeoJSON_E(Da_ear)};
			let Data_tsunami ={type :"FeatureCollection", features : getGeoJSON_T(Da_tsu)};
			let Data_volcano ={type :"FeatureCollection", features: getGeoJSON_V(Da_vol)};
			let Data_countries ={type :"FeatureCollection",features: Polygon_clean(countries)};
			let Data_continents ={type :"FeatureCollection",features: Polygon_clean(continents)};


			var style_polygons = {
				"fillColor" :'white',
				"color" : "#f55919",
				"opacity" : 0.7,
				"dashArray": '20,10'
			};

			//console.log(countries.features.length);
			function onEachFeatureDelim(feature, layer){
			//continents
			/*
				if (feature.properties && feature.properties.continent) {
					layer.bindPopup(feature.properties.continent);
					layer.on("click", function(event){
						mymap.fitBounds(event.target.getBounds());
					});
				}
				*/
				//Plates
				if (feature.properties && feature.properties.PlateName) {
					layer.bindPopup(feature.properties.PlateName);
					layer.on("click", function(event){
						mymap.fitBounds(event.target.getBounds());
					});
				}
				//countries
				if (feature.properties && feature.properties.name) {
					layer.bindPopup(feature.properties.name);
					layer.on("click", function(event){
						mymap.fitBounds(event.target.getBounds());
					});
			}
			};
			function onEachFeatureEvent (feature, layer) {
				layer.bindPopup(feature.geometry.coordinates.toString());
			}
			var layer=L.geoJSON(Data_countries,{onEachFeature: onEachFeatureDelim}).addTo(mymap);
			layer.setStyle(style_polygons);
			var layerevents=L.geoJSON(Data_volcano,{onEachFeature: onEachFeatureEvent}).addTo(mymap);
			L.marker([0.0,0.0], {icon: MarkerEar}).addTo(mymap);
			L.marker([0.0,15], {icon: MarkerTsu}).addTo(mymap);
			L.marker([15,0.0], {icon: MarkerVol}).addTo(mymap);
			d3.select("#Continents")
				.on("click",function(){
					layer.clearLayers();
					layer.addData(Data_continents);
					layer.setStyle(style_polygons);
					mymap.setView([27, 0], 2);
				});
			d3.select("#Countries")
					.on("click",function(){
						layer.clearLayers();
						layer.addData(Data_countries);
						layer.setStyle(style_polygons);
						mymap.setView([27, 0], 2);
					});
			d3.select("#Plates")
				.on("click",function(){
					layer.clearLayers();
					layer.addData(tect);
					layer.setStyle(style_polygons);
					mymap.setView([27, 0], 2);
				});
			d3.select("#ClearDelim")
				.on("click",function(){
					layer.clearLayers();
			});
			d3.select("#Earthquake")
				.on("click",function() {
					layerevents.addData(Data_earthquake);
					layerevents.setStyle(MarkerEar);
			});
			d3.select("#Tsunami")
				.on("click",function() {
					/*
					console.log(Data_tsunami);
					for (let i=0;i<Data_tsunami.features.length;i++) {
						 layerevents=L.marker([Data_tsunami.features[i].geometry.coordinates[0],Data_tsunami.features[i].geometry.coordinates[1]], {icon:MarkerTsu}).addTo(mymap);

					};
					*/
					layerevents.addData(Data_tsunami);
					layerevents.setStyle(MarkerTsu);
					//layerevents.marker(Data_tsunami, {icon:MarkerTsu}).addTo(mymap);
					//layerevents.addData(Data_tsunami, {icon: MarkerTsu});
					//layerevents.setStyle(MarkerTsu);
			});
			d3.select("#Volcano")
				.on("click",function() {
					layerevents.addData(Data_volcano);
					layerevents.setStyle(MarkerVol);
			});
			d3.select("#ClearEvents")
				.on("click",function() {
					layerevents.clearLayers();
				});
			});
		});
	});
	});
	});
	});

</script>
